<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.benefit.mapper.UserAddressMapper">


    <sql id="baseColumns">
        id, user_id, receiver_name, receiver_phone, status,
        province, city, district, detail_address, postal_code, create_time, update_time
    </sql>

    <!-- 动态查询条件 -->
    <sql id="dynamicWhere">
        <where>
            <!-- 用户ID -->
            <if test="request.userId != null">
                AND user_id = #{request.userId}
            </if>

            <!-- 收货人姓名（模糊查询） -->
            <if test="request.receiverName != null and request.receiverName != ''">
                AND receiver_name LIKE CONCAT('%', #{request.receiverName}, '%')
            </if>

            <!-- 手机号（精确查询） -->
            <if test="request.receiverPhone != null and request.receiverPhone != ''">
                AND receiver_phone = #{request.receiverPhone}
            </if>

            <!-- 状态筛选 -->
            <if test="request.status != null">
                AND status = #{request.status}
            </if>

            <!-- 地区筛选（省市区任意组合） -->
            <if test="request.province != null and request.province != ''">
                AND province = #{request.province}
            </if>
            <if test="request.city != null and request.city != ''">
                AND city = #{request。city}
            </if>
            <if test="request.district != null and request.district != ''">
                AND district = #{request.district}
            </if>

            <!-- 时间范围查询 -->
            <if test="request.createTime != null">
                AND create_time >= #{request.createTime}
                AND create_time <![CDATA[ <= ]]> #{request.createTime}
            </if>
        </where>
    </sql>

    <!-- 分页查询用户地址 -->
    <select id="selectPackageList" resultType="com.benefit.vo.UserAddressVo">
        SELECT
        <include refid="baseColumns"/>
        FROM t_user_address
        <include refid="dynamicWhere"/>
        <!-- 默认排序：默认地址优先，按更新时间倒序 -->
        ORDER BY create_time DESC
    </select>

</mapper>